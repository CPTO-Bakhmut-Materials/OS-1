### Shell Scripting - продовження 2

#### Мета

Мета ознайомитися з поняттям - скрипт

#### Скрипт

Скрипт — це, по суті, послідовність команд у файлі. Bash зчитує файл і обробляє команди по порядку. Він переходить до наступної команди лише тоді, коли поточна була завершена.

(Винятком є випадки, коли команду було вказано виконувати асинхронізовано, у фоновому режимі. Не переймайтеся цим занадто сильно на даному етапі — ми дізнаємося, як це працює, пізніше.)

Практично будь-який приклад командного рядка можна також використовувати в скрипті.

Створити скрипт — легко. Почніть зі створення нового файлу і додайте це в перший рядок:

```bash
#!/bin/bash
```

Цей заголовок називається директивою інтерпретатора (його також називають «hashbang» або «shebang»). Він вказує на те, що /bin/bash має використовуватися як інтерпретатор, коли цей файл запускається як виконувана команда. Коли ядро операційної системи виконує небінарний файл, воно зчитує перший рядок. Якщо рядок починається з #!, ядро використовує його, щоб визначити, якому інтерпретатору передати файл. (Існують й інші дійсні способи зробити це, див. нижче). Символи #! мають бути на самому початку файлу, без пробілів чи порожніх рядків перед ними. Команди нашого скрипта будуть розташовані на окремих рядках нижче.

Порада — замість #!/bin/bash ви можете використовувати: #!/usr/bin/env bash

Команда env шукає у змінній $PATH виконуваний файл, названий її першим аргументом (у цьому випадку — «bash»).

Будь ласка, не дозволяйте вводити себе в оману скриптам або прикладам в Інтернеті, які використовують /bin/sh як інтерпретатор. sh — це не bash! Сам по собі Bash є «sh-сумісною» оболонкою (це означає, що він може запускати більшість скриптів для sh і має багато схожого синтаксису), проте зворотне твердження не є правильним; деякі функції Bash зламаються або спричинять неочікувану поведінку в sh.

Також, будь ласка, утримуйтеся від надання скриптам розширення .sh. Воно не має жодної практичної мети та вводить в оману (оскільки це буде bash-скрипт, а не sh-скрипт).

Цілком припустимо використовувати Windows для написання скриптів. Проте уникайте використання «Блокнота» (Notepad). Microsoft Notepad створює файли лише з DOS-стилем закінчення рядків. Закінчення рядків у стилі DOS завершуються двома символами: поверненням каретки (CR; ASCII 0xD) і переведенням рядка (LF; ASCII 0xA). Bash розуміє закінчення рядків, що містять лише символи LF. У результаті символ повернення каретки спричинить «неочікуваний сюрприз», якщо не знати про його наявність (дуже дивні повідомлення про помилки). Якщо це можливо, використовуйте більш функціональні редактори, як-от Vim, Emacs, Kate, GEdit... Якщо ні, то перед запуском скриптів із них потрібно буде видалити символи повернення каретки.

Після того, як файл скрипта створено, його можна виконати так:

```bash
$ bash myscript
```

У цьому прикладі ми запускаємо bash і даємо йому команду прочитати скрипт. Коли ми робимо це таким чином, рядок з #! є просто коментарем, і Bash взагалі нічого з ним не робить.

Альтернативно ми можемо надати нашим скриптам права на виконання. За такого методу, замість того, щоб викликати Bash вручну, ми можемо запускати скрипт як окрему програму:

```bash
$ chmod +x myscript  # Позначаємо файл як виконуваний.
$ ./myscript         # Тепер myscript можна запускати напряму.
```

Коли ми запускаємо команду таким чином, операційна система (ОС) використовує рядок #!, щоб визначити, який інтерпретатор використовувати.

Щодо того, де зберігати скрипт, існує кілька варіантів. Зазвичай люди воліють тримати свої скрипти у власній директорії; це запобігає втручанню вашого скрипта в роботу інших користувачів системи. Дехто полюбляє тримати свої скрипти у вже існуючих директоріях, що входять до PATH, бо ці люди вважають, що ніколи не припустяться помилки.

Щоб використовувати власну директорію:

```bash
$ mkdir -p "$HOME/bin"
$ echo 'PATH="$HOME/bin:$PATH"' >> "$HOME/.bashrc"
$ source "$HOME/.bashrc"
```

Перша команда створить директорію під назвою bin всередині вашої домашньої директорії (директорії, що належить особисто вам). Традиційно папки, що містять команди, називаються bin, навіть якщо ці команди є скриптами, а не скомпільованими («бінарними») програмами. Друга команда додає рядок із присвоєнням змінної до файлу. Ця змінна — PATH, і ми додаємо цей рядок до конфігураційного файлу Bash (.bashrc). Кожен новий інтерактивний екземпляр Bash тепер перевірятиме наявність виконуваних скриптів у нашій новій директорії перед перевіркою будь-яких директорій, які вже були в PATH. Третя команда наказує Bash перечитати свій конфігураційний файл.

Дехто воліє використовувати іншу директорію для своїх персональних скриптів, наприклад $HOME/.config/bin або $HOME/.local/bin. Ви можете використовувати будь-яку, яка вам подобається, головне — будьте послідовними.

Зміни в конфігураційному файлі Bash не набудуть чинності миттєво; нам потрібно зробити крок для перечитування файлу. У прикладі вище ми використали source "$HOME/.bashrc". Ми також могли б використати exec bash або просто закрити поточний термінал і відкрити новий. Тоді Bash ініціалізувався б знову, прочитавши .bashrc (і, можливо, інші файли).

У будь-якому разі, тепер ми можемо покласти наш скрипт у нашу директорію bin і запускати його як звичайну команду — нам більше не потрібно додавати шлях до файлу перед назвою нашого скрипта (як частина ./ у попередньому прикладі):

```bash
$ mv myscript "$HOME/bin"
$ myscript
```